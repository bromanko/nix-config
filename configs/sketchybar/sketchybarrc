#!/bin/bash

# This is a basic sketchybar configuration
# See https://felixkratz.github.io/SketchyBar/ for documentation

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Bar appearance
sketchybar --bar \
  height=30 \
  blur_radius=30 \
  position=top \
  sticky=off \
  padding_left=10 \
  padding_right=10 \
  corner_radius=6 \
  color=0x651e1e2e

# Default item settings
sketchybar --default \
  icon.font="SF Pro:Regular:14.0" \
  icon.color=0xffffffff \
  icon.y_offset=0 \
  label.font="SF Pro Text:Regular:12.0" \
  label.color=0xffffffff \
  label.y_offset=0 \
  padding_left=5 \
  padding_right=5

# Left items
sketchybar --add item apple left \
  --set apple \
    icon=􀣺 \
    icon.font="SF Pro:Regular:16.0" \
    icon.padding_left=9 \
    icon.padding_right=8 \
    icon.y_offset=0 \
    padding_right=8 \
    label.drawing=off \
    click_script="$PLUGIN_DIR/apple.sh"

# Bracket for apple with background
sketchybar --add bracket apple_bracket apple \
  --set apple_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Aerospace workspaces
sketchybar --add event aerospace_workspace_change

# Spacer between apple and workspaces
sketchybar --add item spacer.left left \
  --set spacer.left \
    width=8 \
    background.drawing=off

for i in {1..10}; do
  sketchybar --add item "space.$i" left \
    --set "space.$i" \
      icon="$i" \
      icon.padding_left=8 \
      icon.padding_right=8 \
      icon.y_offset=0 \
      label.drawing=off \
      click_script="$PLUGIN_DIR/aerospace_switch.sh $i"
done

# Bracket for all spaces with shared background
sketchybar --add bracket spaces_bracket space.1 space.2 space.3 space.4 space.5 space.6 space.7 space.8 space.9 space.10 \
  --set spaces_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Single handler for all workspace updates
sketchybar --add item aerospace_handler left \
  --set aerospace_handler \
    drawing=off \
    script="$PLUGIN_DIR/aerospace.sh" \
  --subscribe aerospace_handler aerospace_workspace_change

# Right items (note: added right-to-left, so clock is rightmost)

# Clock
sketchybar --add item clock right \
  --set clock \
    icon.drawing=off \
    label.padding_left=8 \
    label.padding_right=8 \
    update_freq=10 \
    script="$PLUGIN_DIR/clock.sh"

sketchybar --add bracket clock_bracket clock \
  --set clock_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Spacer
sketchybar --add item spacer.right0 right \
  --set spacer.right0 \
    width=8 \
    background.drawing=off

# Battery (alias of system battery)
sketchybar --add alias "Control Center,Battery" right \
  --set "Control Center,Battery" \
    alias.color=0xff1e1e2e \
    padding_left=8 \
    padding_right=8

sketchybar --add bracket battery_bracket "Control Center,Battery" \
  --set battery_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Spacer
sketchybar --add item spacer.right0b right \
  --set spacer.right0b \
    width=8 \
    background.drawing=off

# Weather
sketchybar --add item weather right \
  --set weather \
    icon.padding_left=8 \
    label.padding_right=8 \
    update_freq=1800 \
    script="$PLUGIN_DIR/weather.sh"

sketchybar --add bracket weather_bracket weather \
  --set weather_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Spacer
sketchybar --add item spacer.right1 right \
  --set spacer.right1 \
    width=8 \
    background.drawing=off

# Wifi (alias of system wifi)
sketchybar --add alias "Control Center,WiFi" right \
  --set "Control Center,WiFi" \
    alias.color=0xff1e1e2e \
    padding_left=8 \
    padding_right=8

sketchybar --add bracket wifi_bracket "Control Center,WiFi" \
  --set wifi_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Spacer
sketchybar --add item spacer.right2 right \
  --set spacer.right2 \
    width=8 \
    background.drawing=off

# System resources group (cpu, memory)
sketchybar --add item memory right \
  --set memory \
    icon=􀫦 \
    icon.font="SF Pro:Regular:16.0" \
    icon.padding_left=8 \
    label.padding_right=8 \
    update_freq=15 \
    script="$PLUGIN_DIR/memory.sh"

sketchybar --add item cpu right \
  --set cpu \
    icon=􀫥 \
    icon.font="SF Pro:Regular:16.0" \
    icon.padding_left=8 \
    label.padding_right=4 \
    update_freq=5 \
    script="$PLUGIN_DIR/cpu.sh"

sketchybar --add bracket resources_bracket cpu memory \
  --set resources_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Spacer
sketchybar --add item spacer.right3 right \
  --set spacer.right3 \
    width=8 \
    background.drawing=off

# Tailscale
sketchybar --add event tailscale_update
sketchybar --add item tailscale right \
  --set tailscale \
    icon.font="Symbols Nerd Font:Regular:16.0" \
    icon.padding_left=8 \
    icon.padding_right=8 \
    update_freq=30 \
    script="$PLUGIN_DIR/tailscale.sh" \
    click_script="$PLUGIN_DIR/tailscale_click.sh" \
  --subscribe tailscale tailscale_update

sketchybar --add bracket tailscale_bracket tailscale \
  --set tailscale_bracket \
    background.color=0x30ffffff \
    background.corner_radius=8 \
    background.height=22

# Appearance change handler (light/dark mode)
sketchybar --add item appearance_handler left \
  --set appearance_handler \
    drawing=off \
    width=0 \
    script="$PLUGIN_DIR/appearance.sh" \
  --subscribe appearance_handler system_appearance_change

# Initialize
sketchybar --update

# Force initial aerospace workspace update
$PLUGIN_DIR/aerospace.sh

# Set initial appearance colors
$PLUGIN_DIR/appearance.sh
